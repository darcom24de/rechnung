<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Rechnung ‚Äì darcom24</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .no-print {
      margin-bottom: 20px;
    }
    @media print {
      .no-print {
        display: none !important;
      }
      table {
        page-break-inside: avoid;
      }
    }
    /* Dein Briefkopf */
    #briefkopf {
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.5;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    .summary {
      margin-top: 20px;
      text-align: right;
    }
  </style>
</head>
<body>

  <!-- Briefkopf -->
  <div id="briefkopf">
    <strong>HC-Shop</strong><br>
    Pankstra√üe 46<br>
    13357 Berlin<br>
    USt-ID-Nr.: DE353633206
  </div>

  <!-- Buttons -->
  <div class="no-print">
    <button onclick="window.print()">üñ®Ô∏è Drucken</button>
    <button onclick="exportCSV()">üìÑ CSV Export</button>
    <button onclick="downloadPDF()">üì• PDF herunterladen</button>
    <button onclick="addArticle()">‚ûï Artikel hinzuf√ºgen</button>
  </div>

  <h2 style="display: flex; justify-content: space-between; align-items: center;">
  RECHNUNG
  <span id="rechnungsnummer" style="font-size: 0.9em; font-weight: normal;"></span>
</h2>

  <!-- Artikeltabelle -->
  <table id="artikelTabelle">
    <thead>
      <tr>
        <th>Pos</th>
        <th>Artikel</th>
        <th>Menge</th>
        <th>Einzelpreis</th>
        <th>Gesamtpreis</th>
      </tr>
    </thead>
    <tbody>
      <!-- Artikelzeilen werden hier erg√§nzt -->
    </tbody>
  </table>

  <!-- Summen -->
  <div class="summary">
    <p>Nettobetrag: <span id="netto">0,00 ‚Ç¨</span></p>
    <p>19% MwSt: <span id="mwst">0,00 ‚Ç¨</span></p>
    <p><strong>Gesamtsumme: <span id="gesamt">0,00 ‚Ç¨</span></strong></p>
  </div>

  <script>
    let position = 1;
    const tabelle = document.querySelector('#artikelTabelle tbody');
    const nettoSpan = document.getElementById('netto');
    const mwstSpan = document.getElementById('mwst');
    const gesamtSpan = document.getElementById('gesamt');

    function addArticle() {
      const artikel = prompt('Artikelname:');
      const menge = parseInt(prompt('Menge:'), 10);
      const preis = parseFloat(prompt('Einzelpreis (‚Ç¨):').replace(',', '.'));

      if (!artikel || isNaN(menge) || isNaN(preis)) {
        alert('Ung√ºltige Eingabe.');
        return;
      }

      const gesamt = (menge * preis).toFixed(2).replace('.', ',') + ' ‚Ç¨';

      const zeile = document.createElement('tr');
      zeile.innerHTML = `
        <td>${position++}</td>
        <td>${artikel}</td>
        <td>${menge}</td>
        <td>${preis.toFixed(2).replace('.', ',')} ‚Ç¨</td>
        <td>${gesamt}</td>
      `;
      tabelle.appendChild(zeile);

      updateSummary();
    }

    function updateSummary() {
      let netto = 0;
      tabelle.querySelectorAll('tr').forEach(row => {
        const gesamtCell = row.children[4];
        if (gesamtCell) {
          const betrag = parseFloat(gesamtCell.textContent.replace('‚Ç¨', '').replace(',', '.'));
          if (!isNaN(betrag)) netto += betrag;
        }
      });
      const mwst = netto * 0.19;
      const gesamt = netto + mwst;

      nettoSpan.textContent = netto.toFixed(2).replace('.', ',') + ' ‚Ç¨';
      mwstSpan.textContent = mwst.toFixed(2).replace('.', ',') + ' ‚Ç¨';
      gesamtSpan.textContent = gesamt.toFixed(2).replace('.', ',') + ' ‚Ç¨';
    }

    function exportCSV() {
      let csv = "Pos,Artikel,Menge,Einzelpreis,Gesamtpreis\n";
      document.querySelectorAll("#artikelTabelle tbody tr").forEach(row => {
        const cols = Array.from(row.children).map(td => td.textContent.replace(' ‚Ç¨', '').replace(',', '.'));
        csv += cols.join(",") + "\n";
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "rechnung.csv";
      link.click();
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(12);
      doc.text("HC-Shop\nPankstra√üe 46\n13357 Berlin\nUSt-ID-Nr.: DE353633206", 14, 15);
      doc.setFontSize(16);
      doc.text("RECHNUNG", 105, 30, null, null, "center");

      const rows = [];
      document.querySelectorAll("#artikelTabelle tbody tr").forEach(row => {
        const data = Array.from(row.children).map(td => td.textContent);
        rows.push(data);
      });

      doc.autoTable({
        head: [['Pos', 'Artikel', 'Menge', 'Einzelpreis', 'Gesamtpreis']],
        body: rows,
        startY: 40
      });

      let netto = nettoSpan.textContent;
      let mwst = mwstSpan.textContent;
      let gesamt = gesamtSpan.textContent;

      doc.setFontSize(12);
      doc.text(`Nettobetrag: ${netto}`, 140, doc.lastAutoTable.finalY + 10, { align: 'right' });
      doc.text(`19% MwSt: ${mwst}`, 140, doc.lastAutoTable.finalY + 20, { align: 'right' });
      doc.text(`Gesamtsumme: ${gesamt}`, 140, doc.lastAutoTable.finalY + 30, { align: 'right' });

      const kundenname = prompt("Kundenname f√ºr Dateiname:");
      const filename = kundenname ? `Rechnung_${kundenname}.pdf` : 'Rechnung.pdf';
      doc.save(filename);
    }

    // Automatisch ersten Artikel abfragen beim Laden der Seite
    window.onload = function () {
      addArticle();
    };
  </script>
</body>
</html>
